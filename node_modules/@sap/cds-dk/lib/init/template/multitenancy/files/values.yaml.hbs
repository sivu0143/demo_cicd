---
srv:
  bindings:
    {{#isJava}}
    {{#hasXsuaa}}
    saas-registry:
      serviceInstanceName: saas-registry
    {{/hasXsuaa}}
    {{^hasXsuaa}}
    subscription-manager:
      serviceInstanceName: subscription-manager
    {{/hasXsuaa}}
    {{/isJava}}
    service-manager:
      serviceInstanceName: service-manager
{{#isJava}}
  env:
    CDS_MULTITENANCY_APPUI_TENANTSEPARATOR: "-"
{{/isJava}}
service-manager:
  serviceOfferingName: service-manager
  servicePlanName: container
{{#hasXsuaa}}
saas-registry:
  serviceOfferingName: saas-registry
  servicePlanName: application
  parameters:
    appName: {{appName}}-{{#literal}}{{ .Release.Namespace }}{{/literal}}
    xsappname: {{appName}}-{{#literal}}{{ .Release.Namespace }}{{/literal}}
    displayName: {{appName}}
    description: {{appDescription}}
    category: "CAP Application"
    appUrls:
      onSubscriptionAsync: true
      onUnSubscriptionAsync: true
      onUpdateDependenciesAsync: true
      callbackTimeoutMillis: 300000{{#isJava}}{{#literal}}
      getDependencies: https://{{ .Release.Name }}-srv-{{ .Release.Namespace }}.{{ .Values.global.domain }}/mt/v1.0/subscriptions/dependencies
      onSubscription: https://{{ .Release.Name }}-srv-{{ .Release.Namespace }}.{{ .Values.global.domain }}/mt/v1.0/subscriptions/tenants/{tenantId}
      {{/literal}}{{/isJava}}{{#isNodejs}}{{#literal}}
      getDependencies: https://{{ .Release.Name }}-sidecar-{{ .Release.Namespace }}.{{ .Values.global.domain }}/-/cds/saas-provisioning/dependencies
      onSubscription: https://{{ .Release.Name }}-sidecar-{{ .Release.Namespace }}.{{ .Values.global.domain }}/-/cds/saas-provisioning/tenant/{tenantId}
      {{/literal}}{{/isNodejs}}
{{/hasXsuaa}}

{{^hasXsuaa}}
subscription-manager:
  serviceOfferingName: subscription-manager
  servicePlanName: provider
  parameters:
    appCallbacks:
      dependenciesCallbacks:
        {{#literal}}url: https://{{ .Release.Name }}-sidecar-{{ .Release.Namespace }}.cert.{{ .Values.global.domain }}/-/cds/sms-provisioning/dependencies/{app_tid}{{/literal}}
      subscriptionCallbacks:
        {{#literal}}url: https://{{ .Release.Name }}-sidecar-{{ .Release.Namespace }}.cert.{{ .Values.global.domain }}/-/cds/sms-provisioning/tenant/{app_tid}{{/literal}}
    appName: {{appName}}
    applicationType: application
    category: "CAP Application"
    description: {{appDescription}}
    displayName: {{appName}}
    subscribeEnable: true
    unsubscribeEnable: true
    iasServiceInstanceName: {{appName}}-identity
{{/hasXsuaa}}

sidecar:
  bindings:
    {{#hasXsuaa}}
    auth:
      serviceInstanceName: xsuaa
    {{/hasXsuaa}}
    {{#hasIas}}
    auth:
      serviceInstanceName: identity
    {{/hasIas}}
    {{#isNodejs}}
    {{#hasXsuaa}}
    saas-registry:
      serviceInstanceName: saas-registry
    {{/hasXsuaa}}
    {{^hasXsuaa}}
    subscription-manager:
      serviceInstanceName: subscription-manager
    {{/hasXsuaa}}
    {{/isNodejs}}
    service-manager:
      serviceInstanceName: service-manager
  image:
    repository: {{appName}}-sidecar
  resources:
    limits:
      ephemeral-storage: 1G
      memory: 500M
    requests:
      ephemeral-storage: 1G
      cpu: 500m
      memory: 500M
  health:
    liveness:
      path: /health
    readiness:
      path: /health
