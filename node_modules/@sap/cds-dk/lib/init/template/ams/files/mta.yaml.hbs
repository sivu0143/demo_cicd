modules:
  - name: {{appName}}-srv
    type: {{language}}
    path: {{& srvPath}}
    deployed-after:
      - {{appName}}-ams-policies-deployer
    properties:
      AMS_DCL_ROOT: ams/dcl

  - name: {{appName}}-ams-policies-deployer
    type: javascript.nodejs
    {{#isJava}}
    path: .
    build-parameters:
      builder: custom
      commands:
        - npx cds build --for ams
      build-result: srv/src/gen/policies
    {{/isJava}}
    {{^isJava}}
    path: gen/policies
    {{/isJava}}
    parameters:
      buildpack: nodejs_buildpack
      no-route: true
      no-start: true
      tasks:
        - name: deploy-dcl
          command: npm start
          memory: 512M
    requires:
      - name: {{appName}}-ias
        parameters:
          config:
            credential-type: X509_GENERATED
            app-identifier: ams-policy-deployer
