namespace cds.xt;

entity Tenants {
    key ID         : String;
        metadata   : LargeString;
        createdAt  : Timestamp @cds.on.insert : $now;
        modifiedAt : Timestamp @cds.on.insert : $now  @cds.on.update : $now;
        schema     : String;
}

entity Jobs {
    key ID         : String;
        status     : Status default #QUEUED;
        service    : String;
        op         : String;
        error      : String;
        result     : LargeString;
        createdAt  : Timestamp  @cds.on.insert: $now;
        modifiedAt : Timestamp  @cds.on.insert: $now  @cds.on.update: $now;
        tasks      : Composition of many Tasks on tasks.job = $self;
}

entity Tasks {
    key job        : Association to Jobs;
    key ID         : String;
        tenant     : String(100);
        service    : String;
        op         : String;
        error      : String;
        status     : Status default #QUEUED;
        createdAt  : Timestamp  @cds.on.insert: $now;
        modifiedAt : Timestamp  @cds.on.insert: $now  @cds.on.update: $now;
        database   : String;
}

type Status : String enum {
    QUEUED;
    RUNNING;
    FINISHED;
    CANCELLED;
    TIMEOUT;
    FAILED;
}
