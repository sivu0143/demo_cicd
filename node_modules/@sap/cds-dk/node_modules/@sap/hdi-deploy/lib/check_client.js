'use strict';

const npmPackageVersion = process.env['npm_package_version'] || '<unknown>';

function errorAndExit (err) {
  console.error(`npm error @sap/hdi-deploy@${npmPackageVersion}: ${err}`);
  process.exit(1);
}
function success (msg) {
  console.info(`postinstall @sap/hdi-deploy@${npmPackageVersion}: ${msg}`);
}

let hana_client;
try {
  hana_client = require.resolve('@sap/hana-client');
  success('hana-client peer dependency is installed');
} catch (e) {
  console.warn(e.message);
}
let hdb;
try {
  hdb = require.resolve('hdb');
  success('hdb client peer dependency is installed');
} catch (e) {
  console.warn(e.message);
}
if (!hana_client && !hdb) {
  errorAndExit("requires a peer of either '@sap/hana-client' or 'hdb' but none is installed. You must install peer dependencies yourself or add them to your package.json file.");
} else {
  success('success');
}
