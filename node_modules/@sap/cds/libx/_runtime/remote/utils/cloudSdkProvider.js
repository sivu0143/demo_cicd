const cds = require('../../cds')

let _cloudSdkConnectivity
const getCloudSdkConnectivity = () => (_cloudSdkConnectivity ??= require('@sap-cloud-sdk/connectivity'))

let _cloudSdkResilience
const getCloudSdkResilience = () => (_cloudSdkResilience ??= require('@sap-cloud-sdk/resilience'))

let _cloudSdk
const getCloudSdk = () => {
  _cloudSdk ??= require('@sap-cloud-sdk/http-client')
  const { version } = require('@sap-cloud-sdk/http-client/package.json')
  if (version && Number(version.split('.')[0]) < 4)
    cds.utils.deprecated({ old: `SAP Cloud SDK version ${version} `, use: `SAP Cloud SDK version >= 4.` })
  return _cloudSdk
}

module.exports = {
  getCloudSdkConnectivity,
  getCloudSdkResilience,
  getCloudSdk
}
